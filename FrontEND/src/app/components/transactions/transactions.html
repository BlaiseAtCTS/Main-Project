<div class="dashboard-container">
  <!-- Sidebar Navigation -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <h3>Banking App</h3>
    </div>
    
    <ul class="nav-links">
      <li>
        <a routerLink="/dashboard" routerLinkActive="active">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li>
        <a routerLink="/accounts" routerLinkActive="active">
          <i class="fas fa-wallet"></i>
          <span>Accounts</span>
        </a>
      </li>
      <li>
        <a routerLink="/transactions" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <i class="fas fa-exchange-alt"></i>
          <span>Transactions</span>
        </a>
      </li>
      <li>
        <a routerLink="/profile" routerLinkActive="active">
          <i class="fas fa-user"></i>
          <span>Profile</span>
        </a>
      </li>
    </ul>
    
    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-header">
      <h1><i class="fas fa-exchange-alt"></i> Transactions</h1>
    </div>

    <!-- Error/Success Messages -->
    @if (error()) {
      <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle"></i>
        {{ error() }}
      </div>
    }

    @if (success()) {
      <div class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        {{ success() }}
      </div>
    }

    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button 
        class="tab-btn" 
        [class.active]="activeTab() === 'transfer'"
        (click)="setActiveTab('transfer')">
        <i class="fas fa-paper-plane"></i> Transfer Money
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab() === 'history'"
        (click)="setActiveTab('history')">
        <i class="fas fa-history"></i> Transaction History
      </button>
    </div>

    <!-- Transfer Tab -->
    @if (activeTab() === 'transfer') {
      <div class="transfer-section">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-paper-plane"></i> Transfer Money</h3>
          </div>
          <div class="card-body">
            @if (loading()) {
              <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading accounts...</p>
              </div>
            } @else if (accounts().length === 0) {
              <div class="empty-state">
                <i class="fas fa-wallet"></i>
                <p>No accounts available. Please create an account first.</p>
                <a routerLink="/accounts" class="btn btn-primary">Go to Accounts</a>
              </div>
            } @else {
              <form (ngSubmit)="onTransfer()">
                <!-- Source Account -->
                <div class="form-group">
                  <label for="sourceAccount">From Account</label>
                  <select 
                    id="sourceAccount" 
                    class="form-control"
                    [value]="sourceAccountNumber()"
                    (change)="onAccountChange($any($event.target).value)">
                    @for (account of accounts(); track account.accountNumber) {
                      <option [value]="account.accountNumber">
                        {{ account.accountNumber }} - {{ account.type }} ({{ formatCurrency(account.balance) }})
                      </option>
                    }
                  </select>
                </div>

                <!-- Selected Account Info -->
                @if (selectedAccount()) {
                  <div class="account-info">
                    <div class="info-row">
                      <span class="label">Available Balance:</span>
                      <span class="value">{{ formatCurrency(selectedAccount()!.balance) }}</span>
                    </div>
                    <div class="info-row">
                      <span class="label">Account Type:</span>
                      <span class="value">{{ selectedAccount()!.type }}</span>
                    </div>
                  </div>
                }

                <!-- Destination Account -->
                <div class="form-group">
                  <label for="destinationAccount">To Account Number</label>
                  <input 
                    type="text" 
                    id="destinationAccount" 
                    class="form-control"
                    placeholder="Enter destination account number"
                    [value]="destinationAccountNumber()"
                    (input)="destinationAccountNumber.set($any($event.target).value)"
                    required>
                  <small class="form-text">Enter the account number you want to transfer to</small>
                </div>

                <!-- Amount -->
                <div class="form-group">
                  <label for="transferAmount">Amount</label>
                  <input 
                    type="number" 
                    id="transferAmount" 
                    class="form-control"
                    placeholder="0.00"
                    min="0.01"
                    step="0.01"
                    [value]="transferAmount()"
                    (input)="transferAmount.set(+$any($event.target).value)"
                    required>
                  <small class="form-text">Enter the amount you want to transfer</small>
                </div>

                <!-- Submit Button -->
                <div class="form-actions">
                  <button 
                    type="submit" 
                    class="btn btn-primary btn-lg"
                    [disabled]="loading()">
                    @if (loading()) {
                      <i class="fas fa-spinner fa-spin"></i> Processing...
                    } @else {
                      <i class="fas fa-paper-plane"></i> Transfer
                    }
                  </button>
                </div>
              </form>
            }
          </div>
        </div>
      </div>
    }

    <!-- History Tab -->
    @if (activeTab() === 'history') {
      <div class="history-section">
        <!-- Filter Section -->
        <div class="filter-section">
          <div class="filter-group">
            <label for="accountFilter">Account</label>
            <select 
              id="accountFilter" 
              class="form-control"
              [value]="sourceAccountNumber()"
              (change)="onAccountChange($any($event.target).value)">
              @for (account of accounts(); track account.accountNumber) {
                <option [value]="account.accountNumber">
                  {{ account.accountNumber }} - {{ account.type }}
                </option>
              }
            </select>
          </div>

          <div class="filter-group">
            <label for="searchBox">Search</label>
            <input 
              type="text" 
              id="searchBox" 
              class="form-control"
              placeholder="Search transactions..."
              [value]="searchTerm()"
              (input)="onSearch($any($event.target).value)">
          </div>
        </div>

        <!-- Selected Account Info -->
        @if (selectedAccount()) {
          <div class="card account-summary-card">
            <div class="card-body">
              <div class="account-summary">
                <div class="summary-item">
                  <span class="label">Account Number</span>
                  <span class="value">{{ selectedAccount()!.accountNumber }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Type</span>
                  <span class="value">{{ selectedAccount()!.type }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Balance</span>
                  <span class="value balance-amount">{{ formatCurrency(selectedAccount()!.balance) }}</span>
                </div>
              </div>
            </div>
          </div>
        }

        <!-- Transaction Summary Cards -->
        <div class="summary-cards">
          <div class="summary-card deposits">
            <div class="icon"><i class="fas fa-arrow-down"></i></div>
            <div class="details">
              <h4>Total Deposits</h4>
              <p class="amount">{{ formatCurrency(totalDeposits()) }}</p>
            </div>
          </div>

          <div class="summary-card withdrawals">
            <div class="icon"><i class="fas fa-arrow-up"></i></div>
            <div class="details">
              <h4>Total Withdrawals</h4>
              <p class="amount">{{ formatCurrency(totalWithdrawals()) }}</p>
            </div>
          </div>

          <div class="summary-card transfers">
            <div class="icon"><i class="fas fa-exchange-alt"></i></div>
            <div class="details">
              <h4>Total Transfers</h4>
              <p class="amount">{{ formatCurrency(totalTransfers()) }}</p>
            </div>
          </div>
        </div>

        <!-- Transactions Table -->
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-list"></i> Transaction History</h3>
          </div>
          <div class="card-body">
            @if (loadingTransactions()) {
              <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading transactions...</p>
              </div>
            } @else if (filteredTransactions().length === 0) {
              <div class="empty-state">
                <i class="fas fa-receipt"></i>
                <p>No transactions found</p>
                @if (searchTerm()) {
                  <p class="text-muted">Try adjusting your search term</p>
                }
              </div>
            } @else {
              <div class="table-responsive">
                <table class="transactions-table">
                  <thead>
                    <tr>
                      <th (click)="sortBy('id')" class="sortable">
                        ID
                        @if (sortField() === 'id') {
                          <i class="fas" [class.fa-sort-up]="sortDirection() === 'asc'" [class.fa-sort-down]="sortDirection() === 'desc'"></i>
                        }
                      </th>
                      <th (click)="sortBy('type')" class="sortable">
                        Type
                        @if (sortField() === 'type') {
                          <i class="fas" [class.fa-sort-up]="sortDirection() === 'asc'" [class.fa-sort-down]="sortDirection() === 'desc'"></i>
                        }
                      </th>
                      <th>From Account</th>
                      <th>To Account</th>
                      <th (click)="sortBy('amount')" class="sortable text-right">
                        Amount
                        @if (sortField() === 'amount') {
                          <i class="fas" [class.fa-sort-up]="sortDirection() === 'asc'" [class.fa-sort-down]="sortDirection() === 'desc'"></i>
                        }
                      </th>
                      <th (click)="sortBy('timestamp')" class="sortable">
                        Date & Time
                        @if (sortField() === 'timestamp') {
                          <i class="fas" [class.fa-sort-up]="sortDirection() === 'asc'" [class.fa-sort-down]="sortDirection() === 'desc'"></i>
                        }
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (transaction of filteredTransactions(); track transaction.id) {
                      <tr>
                        <td>#{{ transaction.id }}</td>
                        <td>
                          <span class="badge" [ngClass]="getTypeBadgeClass(transaction.type)">
                            {{ transaction.type }}
                          </span>
                        </td>
                        <td>{{ transaction.sourceAccountNumber }}</td>
                        <td>{{ transaction.destinationAccountNumber }}</td>
                        <td class="text-right amount" [class.positive]="transaction.type === 'Deposit'" [class.negative]="transaction.type === 'Withdraw'">
                          {{ formatCurrency(transaction.amount) }}
                        </td>
                        <td>{{ formatDate(transaction.timestamp) }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            }
          </div>
        </div>
      </div>
    }
  </main>
</div>
