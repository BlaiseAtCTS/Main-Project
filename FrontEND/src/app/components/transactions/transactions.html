<div class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50">
  <div class="bg-gradient-to-r from-primary-600 to-secondary-600 text-white py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
      <h1 class="text-3xl font-bold">Transactions</h1>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Status alerts -->
    <ui-alert *ngIf="error()" variant="error" class="mb-4">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <span class="ml-2">{{ error() }}</span>
    </ui-alert>
    <ui-alert *ngIf="success()" variant="success" class="mb-4">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
      <span class="ml-2">{{ success() }}</span>
    </ui-alert>

    <!-- Tabs -->
    <div class="flex gap-2 mb-6">
      <ui-button [variant]="activeTab() === 'transfer' ? 'default' : 'outline'" (click)="setActiveTab('transfer')">Transfer Money</ui-button>
      <ui-button [variant]="activeTab() === 'history' ? 'default' : 'outline'" (click)="setActiveTab('history')">Transaction History</ui-button>
    </div>

    <!-- Transfer Tab -->
    @if (activeTab() === 'transfer') {
      
        <ui-card class="border-0 bg-white/70 backdrop-blur">
          <ui-card-header class="border-b bg-gradient-to-r from-gray-50 to-white">
            <ui-card-title>Transfer Money</ui-card-title>
          </ui-card-header>
          <ui-card-content class="p-6 space-y-4">
            @if (loading()) {
              <div class="flex items-center gap-2 text-gray-600">
                <ui-spinner size="sm"></ui-spinner>
                Loading...
              </div>
            } @else if (accounts().length === 0) {
              <div class="text-center py-8">
                <svg class="h-10 w-10 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h10"/></svg>
                <p class="text-gray-600">No accounts available for transfer</p>
                <div class="mt-3">
                  <ui-button routerLink="/accounts">Go to Accounts</ui-button>
                </div>
              </div>
            } @else {
              <form (ngSubmit)="onTransfer()" class="space-y-4">
                <div>
                  <label class="block text-sm text-gray-600 mb-1">From Account</label>
                  <select class="w-full border rounded px-3 py-2" [value]="transferSourceAccountNumber()" (change)="onTransferSourceAccountChange($any($event.target).value)">
                    @for (account of accounts(); track account.accountNumber) {
                      <option [value]="account.accountNumber">
                        {{ account.accountNumber }} - {{ account.type }} ({{ formatCurrency(account.balance) }})
                      </option>
                    }
                  </select>
                </div>
                @if (selectedTransferSourceAccount()) {
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="p-3 border rounded">
                      <p class="text-xs text-gray-500 mb-1">Available Balance</p>
                      <p class="font-medium">{{ formatCurrency(selectedTransferSourceAccount()!.balance) }}</p>
                    </div>
                    <div class="p-3 border rounded">
                      <p class="text-xs text-gray-500 mb-1">Account Type</p>
                      <p class="font-medium">{{ selectedTransferSourceAccount()!.type }}</p>
                    </div>
                  </div>
                }
                <div>
                  <label class="block text-sm text-gray-600 mb-1">Destination Account Number</label>
                  <input type="text" class="w-full border rounded px-3 py-2" placeholder="Enter destination account number" [value]="destinationAccountNumber()" (input)="destinationAccountNumber.set($any($event.target).value)" required>
                </div>
                <div>
                  <label class="block text-sm text-gray-600 mb-1">Amount</label>
                  <input type="number" class="w-full border rounded px-3 py-2" placeholder="0.00" min="0.01" step="0.01" [value]="transferAmount()" (input)="transferAmount.set(+$any($event.target).value)" required>
                </div>
                <div>
                  <ui-button type="submit" [disabled]="loading()">{{ loading() ? 'Processing...' : 'Transfer' }}</ui-button>
                </div>
              </form>
            }
          </ui-card-content>
        </ui-card>
      
    }

    <!-- History Tab -->
    @if (activeTab() === 'history') {
      <div class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-gray-600 mb-1">Account</label>
            <select class="w-full border rounded px-3 py-2" [value]="historyAccountNumber()" (change)="onAccountChange($any($event.target).value)">
              @for (account of accounts(); track account.accountNumber) {
                <option [value]="account.accountNumber">{{ account.accountNumber }} - {{ account.type }}</option>
              }
            </select>
          </div>
          <div>
            <label class="block text-sm text-gray-600 mb-1">Search</label>
            <input type="text" class="w-full border rounded px-3 py-2" placeholder="Search by amount, type, or description" [value]="searchTerm()" (input)="onSearch($any($event.target).value)">
          </div>
        </div>

        @if (selectedAccount()) {
          
            <ui-card class="border-0 bg-white/70 backdrop-blur">
              <ui-card-content class="p-4 grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <p class="text-xs text-gray-500">Account Number</p>
                  <p class="font-medium">{{ selectedAccount()!.accountNumber }}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-500">Type</p>
                  <p class="font-medium">{{ selectedAccount()!.type }}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-500">Balance</p>
                  <p class="font-medium">{{ formatCurrency(selectedAccount()!.balance) }}</p>
                </div>
              </ui-card-content>
            </ui-card>
          
        }

        <div class="grid grid-cols-1 gap-4">
          
            <ui-card class="border-0 bg-white/70 backdrop-blur">
              <ui-card-content class="p-4 text-center">
                <div class="text-sm text-gray-600">Total Deposits</div>
                <div class="text-2xl font-semibold text-green-600">{{ formatCurrency(totalDeposits()) }}</div>
                <div class="text-xs text-gray-500 mt-1">All deposits to this account</div>
              </ui-card-content>
            </ui-card>
          
        </div>

        
          <ui-card class="border-0 bg-white/70 backdrop-blur">
            <ui-card-header class="border-b bg-gradient-to-r from-gray-50 to-white">
              <ui-card-title>Transaction History</ui-card-title>
            </ui-card-header>
            <ui-card-content class="p-0">
              @if (loadingTransactions()) {
                <div class="p-6 flex items-center gap-2 text-gray-600">
                  <ui-spinner size="sm"></ui-spinner>
                  Loading...
                </div>
              } @else if (filteredTransactions().length === 0) {
                <div class="p-6 text-center text-gray-600">
                  No transactions found
                  @if (searchTerm()) {
                    <div class="text-xs">Try adjusting your search or filter</div>
                  }
                </div>
              } @else {
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" (click)="sortBy('id')">ID</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" (click)="sortBy('type')">Type</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">From Account</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">To Account</th>
                        <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" (click)="sortBy('amount')">Amount</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" (click)="sortBy('timestamp')">Date & Time</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                      @for (transaction of filteredTransactions(); track transaction.id) {
                        <tr>
                          <td class="px-4 py-2">#{{ transaction.id }}</td>
                          <td class="px-4 py-2">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="{
                              'bg-emerald-50 text-emerald-700': transaction.type === 'Deposit',
                              'bg-rose-50 text-rose-700': transaction.type === 'Withdraw',
                              'bg-blue-100 text-blue-700': transaction.type === 'Transfer'
                            }">{{ transaction.type }}</span>
                          </td>
                          <td class="px-4 py-2">{{ transaction.sourceAccountNumber }}</td>
                          <td class="px-4 py-2">{{ transaction.destinationAccountNumber }}</td>
                          <td class="px-4 py-2 text-right">{{ formatCurrency(transaction.amount) }}</td>
                          <td class="px-4 py-2">{{ formatDate(transaction.timestamp) }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              }
            </ui-card-content>
          </ui-card>
        
      </div>
    }
  </div>
</div>
