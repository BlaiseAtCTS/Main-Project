<div class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50">
  <div class="bg-gradient-to-r from-primary-600 to-secondary-600 text-white py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold mb-1">Withdraw Money</h1>
        <p class="text-white/80">Withdraw funds from your account</p>
      </div>
      <ui-button variant="ghost" routerLink="/accounts" class="">Back to Accounts</ui-button>
    </div>
  </div>

  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <ui-alert *ngIf="success()" variant="success" class="mb-4">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
      <span class="ml-2">{{ success() }}</span>
    </ui-alert>
    <ui-alert *ngIf="error()" variant="error" class="mb-4">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <span class="ml-2">{{ error() }}</span>
    </ui-alert>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2">
        
          <ui-card class="border-0 bg-white/70 backdrop-blur">
            <ui-card-header class="border-b bg-gradient-to-r from-gray-50 to-white">
              <ui-card-title>Withdrawal Details</ui-card-title>
            </ui-card-header>
            <ui-card-content class="p-6">
              <form [formGroup]="withdrawForm" (ngSubmit)="onSubmit()" class="space-y-5">
                <div>
                  <label for="accountNumber" class="block text-sm text-gray-600 mb-1">Select Account</label>
                  <select id="accountNumber" class="w-full border rounded px-3 py-2" formControlName="accountNumber" [disabled]="loadingAccounts()">
                    <option value="">Choose an account...</option>
                    <option *ngFor="let account of accounts()" [value]="account.accountNumber">
                      {{ account.type }} - {{ account.accountNumber }} ({{ formatCurrency(account.balance) }})
                    </option>
                  </select>
                  <div *ngIf="loadingAccounts()" class="text-xs text-gray-500 mt-1 flex items-center gap-2">
                    <ui-spinner size="sm"></ui-spinner>
                    Loading accounts...
                  </div>
                </div>

                <div *ngIf="getSelectedAccount()" class="rounded border p-3 bg-amber-50 text-amber-800 text-sm">
                  <strong>Available Balance:</strong> {{ formatCurrency(getSelectedAccount()?.balance || 0) }}
                </div>

                <div>
                  <label for="amount" class="block text-sm text-gray-600 mb-1">Withdrawal Amount</label>
                  <div class="flex items-center gap-2">
                    <span class="px-3 py-2 rounded bg-gray-100 text-gray-600">$</span>
                    <input id="amount" type="number" class="flex-1 border rounded px-3 py-2" formControlName="amount" placeholder="50" min="1" step="10" [max]="getSelectedAccount()?.balance || 0" />
                  </div>
                  <div class="text-xs text-gray-500 mt-1">Enter the amount you want to withdraw</div>
                  <div *ngIf="withdrawForm.get('amount')?.invalid && withdrawForm.get('amount')?.touched" class="text-rose-700 text-xs mt-1">
                    Amount must be greater than $0
                  </div>
                  <div *ngIf="getSelectedAccount() && withdrawForm.get('amount')?.value > getSelectedAccount()!.balance" class="text-rose-700 text-xs mt-1">
                    Insufficient funds! Maximum withdrawal: {{ formatCurrency(getSelectedAccount()?.balance || 0) }}
                  </div>
                </div>

                <div class="flex items-center gap-3">
                  <ui-button type="submit" [disabled]="loading() || withdrawForm.invalid || loadingAccounts() || (!!getSelectedAccount() && ((withdrawForm.get('amount')?.value || 0) > (getSelectedAccount()!.balance || 0)))">
                    <ng-container *ngIf="!loading(); else loadingTpl">Withdraw Now</ng-container>
                  </ui-button>
                  <ng-template #loadingTpl>
                    <div class="flex items-center gap-2">
                      <ui-spinner size="sm"></ui-spinner>
                      Processing...
                    </div>
                  </ng-template>
                  <ui-button variant="outline" routerLink="/accounts">Cancel</ui-button>
                </div>
              </form>
            </ui-card-content>
          </ui-card>
        
      </div>

      <div class="space-y-6">
        
          <ui-card class="border-0 bg-white/70 backdrop-blur">
            <ui-card-header class="border-b bg-gradient-to-r from-gray-50 to-white">
              <ui-card-title>Transaction Summary</ui-card-title>
            </ui-card-header>
            <ui-card-content class="p-6 space-y-4">
              <div *ngIf="!withdrawForm.get('accountNumber')?.value" class="text-center py-2 text-gray-600">
                Select an account to see summary
              </div>
              <div *ngIf="withdrawForm.get('accountNumber')?.value" class="space-y-2">
                <div>
                  <p class="text-xs text-gray-500">Selected Account</p>
                  <p class="font-medium">{{ getSelectedAccount()?.type }}</p>
                  <p class="font-mono text-xs text-gray-500">{{ getSelectedAccount()?.accountNumber }}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-500">Current Balance</p>
                  <p class="text-lg font-semibold">{{ formatCurrency(getSelectedAccount()?.balance || 0) }}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-500">Withdrawal Amount</p>
                  <p class="text-lg font-semibold text-rose-700">- {{ formatCurrency(withdrawForm.get('amount')?.value || 0) }}</p>
                </div>
                <div class="border-t pt-2">
                  <p class="text-xs text-gray-500">New Balance (After Withdrawal)</p>
                  <p class="text-xl font-semibold" [class.text-rose-700]="(getSelectedAccount()?.balance || 0) - (withdrawForm.get('amount')?.value || 0) < 1000" [class.text-primary-600]="(getSelectedAccount()?.balance || 0) - (withdrawForm.get('amount')?.value || 0) >= 1000">
                    {{ formatCurrency((getSelectedAccount()?.balance || 0) - (withdrawForm.get('amount')?.value || 0)) }}
                  </p>
                  <p *ngIf="(getSelectedAccount()?.balance || 0) - (withdrawForm.get('amount')?.value || 0) < 1000" class="text-xs text-rose-700 mt-1">
                    Low balance warning
                  </p>
                </div>
              </div>
            </ui-card-content>
          </ui-card>
        

        
          <ui-card class="border-0 bg-white/70 backdrop-blur">
            <ui-card-content class="p-6">
              <h6 class="font-semibold mb-2">Important</h6>
              <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
                <li>Ensure sufficient balance before withdrawal</li>
                <li>Withdrawals are processed instantly</li>
                <li>No fees for standard withdrawals</li>
                <li>Maintain minimum balance to avoid restrictions</li>
              </ul>
            </ui-card-content>
          </ui-card>
        
      </div>
    </div>
  </div>
</div>
