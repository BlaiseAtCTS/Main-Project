<div class="container mx-auto px-4 py-8">
  @if (profileQuery.isPending()) {
  <div class="flex justify-center items-center h-64">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
  </div>
  } @if (profileQuery.error()) {
  <div class="mt-4 p-4 bg-red-100 text-red-700 rounded">
    {{ profileQuery.error()?.message || 'An error occurred while loading your profile.' }}
  </div>
  } @if (profileQuery.data()) {
  <div class="bg-white shadow rounded-lg p-6">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">Profile Information</h2>
      <button 
        (click)="toggleEditMode()" 
        class="btn-edit"
        [ngClass]="{'btn-save': isEditMode}">
        {{ isEditMode ? 'üíæ Save Changes' : '‚úèÔ∏è Edit Profile' }}
      </button>
    </div>

    <!-- Success Message -->
    @if (successMessage) {
      <div class="alert alert-success mb-4">
        {{ successMessage }}
      </div>
    }

    <!-- Error Message -->
    @if (errorMessage) {
      <div class="alert alert-error mb-4">
        {{ errorMessage }}
      </div>
    }

    <div class="grid md:grid-cols-2 gap-6">
      <!-- Personal Details Section -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Personal Details</h3>
        <div class="space-y-3">
          <!-- Full Name (Read-only) -->
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <div class="form-value">
              {{ profileQuery.data()?.firstName }} {{ profileQuery.data()?.lastName }}
            </div>
          </div>

          <!-- Username (Read-only) -->
          <div class="form-group">
            <label class="form-label">Username</label>
            <div class="form-value">{{ profileQuery.data()?.userName }}</div>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label class="form-label">Email</label>
            @if (isEditMode) {
              <input 
                type="email" 
                class="form-input"
                [(ngModel)]="editableProfile.email"
                placeholder="Enter your email">
            } @else {
              <div class="form-value">{{ profileQuery.data()?.email || 'Not provided' }}</div>
            }
          </div>

          <!-- Phone Number -->
          <div class="form-group">
            <label class="form-label">Phone Number</label>
            @if (isEditMode) {
              <input 
                type="tel" 
                class="form-input"
                [(ngModel)]="editableProfile.phoneNumber"
                placeholder="Enter your phone number">
            } @else {
              <div class="form-value">{{ profileQuery.data()?.phoneNumber || 'Not provided' }}</div>
            }
          </div>

          <!-- Date of Birth -->
          <div class="form-group">
            <label class="form-label">Date of Birth</label>
            @if (isEditMode) {
              <input 
                type="date" 
                class="form-input"
                [(ngModel)]="editableProfile.dateOfBirth"
                placeholder="Enter your date of birth">
            } @else {
              <div class="form-value">{{ profileQuery.data()?.dateOfBirth || 'Not provided' }}</div>
            }
          </div>

          <!-- Age -->
          <div class="form-group">
            <label class="form-label">Age</label>
            @if (isEditMode) {
              <input 
                type="number" 
                class="form-input"
                [(ngModel)]="editableProfile.age"
                placeholder="Enter your age"
                min="18"
                max="120">
            } @else {
              <div class="form-value">{{ profileQuery.data()?.age || 'Not provided' }}</div>
            }
          </div>

          <!-- Gender -->
          <div class="form-group">
            <label class="form-label">Gender</label>
            @if (isEditMode) {
              <select class="form-input" [(ngModel)]="editableProfile.gender">
                <option value="">Select gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
                <option value="Prefer not to say">Prefer not to say</option>
              </select>
            } @else {
              <div class="form-value">{{ profileQuery.data()?.gender || 'Not provided' }}</div>
            }
          </div>

          <!-- Occupation -->
          <div class="form-group">
            <label class="form-label">Occupation</label>
            @if (isEditMode) {
              <input 
                type="text" 
                class="form-input"
                [(ngModel)]="editableProfile.occupation"
                placeholder="Enter your occupation">
            } @else {
              <div class="form-value">{{ profileQuery.data()?.occupation || 'Not provided' }}</div>
            }
          </div>

          <!-- Address -->
          <div class="form-group">
            <label class="form-label">Address</label>
            @if (isEditMode) {
              <textarea 
                class="form-input"
                [(ngModel)]="editableProfile.address"
                placeholder="Enter your address"
                rows="3"></textarea>
            } @else {
              <div class="form-value">{{ profileQuery.data()?.address || 'Not provided' }}</div>
            }
          </div>
        </div>
      </div>

      <!-- Accounts Section -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Accounts</h3>
        <div class="space-y-4">
          @for (account of profileQuery.data()?.accounts || []; track account.accountNumber) {
          <div 
            class="account-card" 
            [ngClass]="{'low-balance-card': account.balance !== null && account.balance < 1000}">
            <div class="flex justify-between items-center">
              <div>
                <div class="account-type">{{ account.type }}</div>
                <div class="account-number">{{ account.accountNumber }}</div>
              </div>
              <div class="text-right">
                <div 
                  class="account-balance"
                  [class.low-balance]="(account.balance ?? 0) < 1000">
                  {{ account.balance != null ? '$' + (account.balance | number : '1.2-2') : '$0.00' }}
                </div>
                @if (account.balance !== null && account.balance < 1000) {
                  <div class="low-balance-badge low-balance">Low Balance</div>
                }
              </div>
            </div>
          </div>
          }
          @if (!profileQuery.data()?.accounts || profileQuery.data()?.accounts.length === 0) {
            <div class="no-accounts">
              <p>No accounts found</p>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
  }
</div>
